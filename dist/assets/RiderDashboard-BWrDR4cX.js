import{c as M,r as o,j as e,M as k,L as T,z as g,u as z,a as B,b as _,C as U,D as q,B as P,o as V,h as G,_ as W,d as A,X as K,P as H,e as E,U as J}from"./index-CCoYmBKk.js";import{c as Q,l as X,a as Y,e as Z,M as ee,T as te,b as L,p as se,d as ae,f as ne,u as ie,L as I}from"./Map-Du-ehJKC.js";const le=[["circle",{cx:"18.5",cy:"17.5",r:"3.5",key:"15x4ox"}],["circle",{cx:"5.5",cy:"17.5",r:"3.5",key:"1noe27"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["path",{d:"M12 17.5V14l-3-3 4-3 2 3h2",key:"1npguv"}]],re=M("bike",le);const oe=[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]],ce=M("crown",oe);const de=[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]],O=M("navigation",de);const ue=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],me=M("share-2",ue);const xe=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],he=M("triangle-alert",xe),$=(t,s)=>{const l=C(s.latitude-t.latitude),n=C(s.longitude-t.longitude),c=Math.sin(l/2)*Math.sin(l/2)+Math.cos(C(t.latitude))*Math.cos(C(s.latitude))*Math.sin(n/2)*Math.sin(n/2),d=6371*(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)));return Math.round(d*100)/100},C=t=>t*(Math.PI/180),ge=(t,s)=>{const l={bike:{base:50,perKm:15},car:{base:100,perKm:25},premium:{base:200,perKm:40}}[s],n=l.base+t*l.perKm;return Math.round(n)},pe=(t,s)=>{const a=[];for(let n=0;n<=20;n++){const c=n/20,r=t.latitude+(s.latitude-t.latitude)*c,d=t.longitude+(s.longitude-t.longitude)*c,m=Math.sin(c*Math.PI)*.002;a.push([r+m,d+m])}return a},fe=async t=>{await new Promise(a=>setTimeout(a,300));const s=[{address:"Gulshan 1, Dhaka",latitude:23.7808,longitude:90.4152},{address:"Dhanmondi 27, Dhaka",latitude:23.7461,longitude:90.3742},{address:"Banani, Dhaka",latitude:23.7937,longitude:90.4066},{address:"Uttara, Dhaka",latitude:23.8759,longitude:90.3795},{address:"Mirpur 10, Dhaka",latitude:23.8069,longitude:90.3687},{address:"Mohakhali, Dhaka",latitude:23.7808,longitude:90.4028},{address:"Farmgate, Dhaka",latitude:23.7577,longitude:90.3897},{address:"Motijheel, Dhaka",latitude:23.7334,longitude:90.4176},{address:"Shahbag, Dhaka",latitude:23.7389,longitude:90.3952},{address:"New Market, Dhaka",latitude:23.7345,longitude:90.3866}];return!t||t.length<2?[]:s.filter(a=>a.address.toLowerCase().includes(t.toLowerCase()))},je=t=>{const a=t/30;return Math.round(a*60)},ye=()=>new Promise(t=>{if(!navigator.geolocation){t({success:!1,error:"Geolocation is not supported by your browser"});return}navigator.geolocation.getCurrentPosition(s=>{t({success:!0,coordinates:{latitude:s.coords.latitude,longitude:s.coords.longitude}})},s=>{let a="Unable to retrieve your location";switch(s.code){case s.PERMISSION_DENIED:a="Location permission denied";break;case s.POSITION_UNAVAILABLE:a="Location information unavailable";break;case s.TIMEOUT:a="Location request timed out";break}t({success:!1,error:a,coordinates:{latitude:23.8103,longitude:90.4125}})},{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})}),F=({value:t,onChange:s,placeholder:a="Enter location",label:l,error:n,icon:c="pickup"})=>{const[r,d]=o.useState(t),[m,y]=o.useState([]),[N,b]=o.useState(!1),[v,u]=o.useState(!1),[f,w]=o.useState(!1),S=o.useRef(null);o.useEffect(()=>{const i=h=>{S.current&&!S.current.contains(h.target)&&u(!1)};return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[]),o.useEffect(()=>{const i=setTimeout(async()=>{if(r.length>=2){b(!0);try{const h=await fe(r);y(h),u(!0)}catch{y([])}finally{b(!1)}}else y([]),u(!1)},300);return()=>clearTimeout(i)},[r]);const R=i=>{d(i.target.value)},x=i=>{d(i.address),s(i),u(!1)},p=async()=>{w(!0);try{const i=await ye();if(i.success&&i.coordinates){const h=`Current Location (${i.coordinates.latitude.toFixed(4)}, ${i.coordinates.longitude.toFixed(4)})`,D={address:h,latitude:i.coordinates.latitude,longitude:i.coordinates.longitude};d(h),s(D),g.success("Current location set")}else if(g.error(i.error||"Unable to get location"),i.coordinates){const h="Dhaka, Bangladesh (Default)",D={address:h,latitude:i.coordinates.latitude,longitude:i.coordinates.longitude};d(h),s(D)}}catch{g.error("Failed to get current location")}finally{w(!1)}},j=c==="pickup"?"text-green-500":"text-red-500";return e.jsxs("div",{className:"relative",ref:S,children:[l&&e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:l}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(k,{className:`h-5 w-5 ${j}`})}),e.jsx("input",{type:"text",value:r,onChange:R,onFocus:()=>m.length>0&&u(!0),placeholder:a,className:`w-full pl-10 pr-12 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all ${n?"border-red-500":"border-gray-300"}`}),e.jsx("button",{type:"button",onClick:p,disabled:f,className:"absolute inset-y-0 right-0 pr-3 flex items-center text-indigo-600 hover:text-indigo-700 transition-colors",title:"Use current location",children:f?e.jsx(T,{className:"h-5 w-5 animate-spin"}):e.jsx(O,{className:"h-5 w-5"})})]}),n&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:n}),v&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto animate-slide-up",children:N?e.jsx("div",{className:"p-4 text-center text-gray-500",children:e.jsx(T,{className:"h-5 w-5 animate-spin mx-auto"})}):m.length>0?m.map((i,h)=>e.jsxs("button",{type:"button",onClick:()=>x(i),className:"w-full text-left px-4 py-3 hover:bg-gray-50 transition-colors flex items-center gap-3 border-b border-gray-100 last:border-b-0",children:[e.jsx(k,{className:`h-4 w-4 ${j} flex-shrink-0`}),e.jsx("span",{className:"text-gray-900",children:i.address})]},h)):e.jsx("div",{className:"p-4 text-center text-gray-500",children:"No locations found"})})]})},be=V({vehicleType:W(["bike","car","premium"])}),Ne=({pickupLocation:t,setPickupLocation:s,dropoffLocation:a,setDropoffLocation:l})=>{const[n,{isLoading:c}]=z(),{register:r,handleSubmit:d,formState:{errors:m},watch:y,setValue:N}=B({resolver:_(be),defaultValues:{vehicleType:"bike"}}),[b,v]=o.useState(null),[u,f]=o.useState(null),w=y("vehicleType");o.useEffect(()=>{if(t&&a){const x=$({latitude:t.latitude,longitude:t.longitude},{latitude:a.latitude,longitude:a.longitude});f(x);const p=ge(x,w);v(p)}else f(null),v(null)},[t,a,w]);const S=async x=>{if(!t||!a){g.error("Please select both pickup and dropoff locations");return}try{const p={pickupLocation:{address:t.address,latitude:t.latitude,longitude:t.longitude},destination:{address:a.address,latitude:a.latitude,longitude:a.longitude}};await n(p).unwrap(),g.success("Ride requested successfully! Waiting for a driver..."),s(null),l(null),N("vehicleType","bike")}catch(p){const j=G(p,"RideRequestForm","Failed to request ride.");g.error(j)}},R=[{type:"bike",label:"Bike",icon:re,description:"Quick & Affordable",baseRate:"৳50"},{type:"car",label:"Car",icon:U,description:"Comfortable Ride",baseRate:"৳100"},{type:"premium",label:"Premium",icon:ce,description:"Luxury Experience",baseRate:"৳200"}];return e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-md animate-slide-up",children:[e.jsxs("h3",{className:"text-xl font-bold mb-6 flex items-center gap-2",children:[e.jsx(O,{className:"text-indigo-600"}),"Request a Ride"]}),e.jsxs("form",{onSubmit:d(S),className:"space-y-5",children:[e.jsx(F,{value:t?.address||"",onChange:s,placeholder:"Enter pickup location",label:"Pickup Location",icon:"pickup"}),e.jsx(F,{value:a?.address||"",onChange:l,placeholder:"Enter dropoff location",label:"Dropoff Location",icon:"dropoff"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Vehicle Type"}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:R.map(x=>{const p=x.icon,j=w===x.type;return e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("input",{type:"radio",value:x.type,className:"sr-only peer",...r("vehicleType")}),e.jsxs("div",{className:`rounded-lg border-2 p-3 text-center transition-all hover:shadow-md ${j?"border-indigo-600 bg-indigo-50 shadow-md":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx(p,{className:`h-6 w-6 mx-auto mb-1 ${j?"text-indigo-600":"text-gray-400"}`}),e.jsx("div",{className:`font-semibold text-sm ${j?"text-indigo-700":"text-gray-700"}`,children:x.label}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:x.description})]})]},x.type)})})]}),b!==null&&u!==null&&e.jsx("div",{className:"bg-gradient-to-r from-indigo-50 to-purple-50 rounded-lg p-4 border border-indigo-100 animate-slide-up",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Estimated Fare"}),e.jsxs("p",{className:"text-2xl font-bold text-indigo-600 flex items-center gap-1",children:[e.jsx(q,{className:"h-5 w-5"}),"৳",b]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Distance"}),e.jsxs("p",{className:"text-lg font-semibold text-gray-900",children:[u.toFixed(2)," km"]})]})]})}),e.jsx(P,{type:"submit",isLoading:c,fullWidth:!0,size:"lg",className:"ripple",children:"Find Driver"})]})]})},ve=Q(function({positions:s,...a},l){const n=new X.Polyline(s,a);return Y(n,Z(l,{overlayContainer:n}))},function(s,a,l){a.positions!==l.positions&&s.setLatLngs(a.positions)}),we=({bounds:t})=>{const s=ie();return o.useEffect(()=>{t.isValid()&&s.fitBounds(t,{padding:[50,50]})},[t,s]),null},ke=({pickup:t,dropoff:s,driverLocation:a,className:l="",showRoute:n=!0})=>{const[c,r]=o.useState([]),[d,m]=o.useState(0),[y,N]=o.useState(0);o.useEffect(()=>{if(t&&s&&n){const u=pe(t,s);r(u);const f=$(t,s);m(f),N(je(f))}else r([]),m(0),N(0)},[t,s,n]);const b=()=>{const u=[];return t&&u.push([t.latitude,t.longitude]),s&&u.push([s.latitude,s.longitude]),a&&u.push([a.latitude,a.longitude]),u.length===0?I.latLngBounds([[23.7,90.3],[23.9,90.5]]):I.latLngBounds(u)},v=t?[t.latitude,t.longitude]:[23.8103,90.4125];return e.jsxs("div",{className:`relative h-full w-full ${l}`,children:[e.jsxs(ee,{center:v,zoom:13,className:"h-full w-full rounded-xl",scrollWheelZoom:!0,children:[e.jsx(te,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.jsx(we,{bounds:b()}),t&&e.jsx(L,{position:[t.latitude,t.longitude],icon:se}),s&&e.jsx(L,{position:[s.latitude,s.longitude],icon:ae}),a&&e.jsx(L,{position:[a.latitude,a.longitude],icon:ne}),c.length>0&&e.jsx(ve,{positions:c,color:"#6366f1",weight:4,opacity:.7})]}),d>0&&e.jsx("div",{className:"absolute bottom-4 left-4 right-4 bg-white rounded-lg shadow-lg p-4 animate-slide-up z-[1000]",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-5 w-5 text-indigo-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Distance"}),e.jsxs("p",{className:"text-lg font-bold text-gray-900",children:[d.toFixed(2)," km"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-5 w-5 text-indigo-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Est. Time"}),e.jsxs("p",{className:"text-lg font-bold text-gray-900",children:[y," min"]})]})]})]})})]})},Se=()=>{const[t,s]=o.useState(!1),a=()=>{s(!0)},l=()=>{window.location.href="tel:911",g.success("Calling Emergency Services...")},n=()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(c=>{const{latitude:r,longitude:d}=c.coords,m=`https://www.google.com/maps?q=${r},${d}`;console.log("Location shared:",m),g.success("Live location shared with emergency contacts!")},()=>{g.error("Unable to retrieve location.")}):g.error("Geolocation is not supported by your browser.")};return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:a,className:"fixed bottom-6 right-6 z-50 bg-red-600 hover:bg-red-700 text-white rounded-full p-4 shadow-2xl animate-pulse focus:outline-none focus:ring-4 focus:ring-red-300","aria-label":"SOS Emergency",children:e.jsx("span",{className:"font-bold text-xl",children:"SOS"})}),t&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl w-full max-w-sm overflow-hidden animate-in fade-in zoom-in duration-200",children:[e.jsxs("div",{className:"bg-red-600 p-4 flex justify-between items-center text-white",children:[e.jsxs("h3",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(he,{className:"h-6 w-6"}),"Emergency Assistance"]}),e.jsx("button",{onClick:()=>s(!1),className:"hover:bg-red-700 rounded-full p-1",children:e.jsx(K,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("p",{className:"text-gray-600 text-center mb-4",children:"What kind of emergency are you facing?"}),e.jsxs(P,{variant:"danger",fullWidth:!0,size:"lg",onClick:l,className:"flex items-center justify-center gap-2",children:[e.jsx(H,{className:"h-5 w-5"}),"Call Police (999)"]}),e.jsxs(P,{variant:"secondary",fullWidth:!0,size:"lg",onClick:n,className:"flex items-center justify-center gap-2",children:[e.jsx(me,{className:"h-5 w-5"}),"Share Live Location"]}),e.jsx("div",{className:"text-xs text-center text-gray-400 mt-4",children:"Using this will instantly notify your emergency contacts."})]})]})})]})},Re=()=>{const[t,s]=o.useState(null),[a,l]=o.useState(null),[n,c]=o.useState(null);return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 relative",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsx(Ne,{pickupLocation:a,setPickupLocation:l,dropoffLocation:n,setDropoffLocation:c})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(E,{className:"h-full min-h-[500px]",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(k,{className:"text-indigo-600"}),"Live Map"]}),e.jsx("div",{className:"h-[450px] rounded-lg overflow-hidden",children:e.jsx(ke,{pickup:a||void 0,dropoff:n||void 0,showRoute:!!(a&&n)})})]})})]}),t&&e.jsx("div",{className:"mt-8 animate-slide-up",children:e.jsxs(E,{children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Current Ride Status"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-indigo-100 rounded-full",children:e.jsx(J,{className:"h-6 w-6 text-indigo-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Driver"}),e.jsx("p",{className:"font-semibold",children:"John Doe"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-green-100 rounded-full",children:e.jsx(k,{className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Status"}),e.jsx("p",{className:"font-semibold",children:"On the way"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-yellow-100 rounded-full",children:e.jsx(A,{className:"h-6 w-6 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"ETA"}),e.jsx("p",{className:"font-semibold",children:"5 minutes"})]})]})]})]})}),e.jsxs("div",{className:"mt-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-bold",children:"Recent Rides"}),e.jsx("button",{onClick:()=>window.location.href="/rider/history",className:"text-indigo-600 hover:text-indigo-700 font-medium text-sm hover:underline",children:"View All →"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[{date:"Today, 10:30 AM",pickup:"Gulshan 2",dropoff:"Dhanmondi 27",fare:250,status:"completed"},{date:"Yesterday, 3:15 PM",pickup:"Banani",dropoff:"Mirpur 10",fare:180,status:"completed"}].map((r,d)=>e.jsxs(E,{className:"hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("span",{className:"text-sm text-gray-500",children:r.date}),e.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium",children:r.status})]}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsx("span",{className:"text-gray-700",children:r.pickup})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(k,{className:"h-4 w-4 text-red-500"}),e.jsx("span",{className:"text-gray-700",children:r.dropoff})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-3 border-t",children:[e.jsxs("span",{className:"text-lg font-bold text-indigo-600",children:["৳",r.fare]}),e.jsx("button",{className:"text-sm text-indigo-600 hover:text-indigo-700 font-medium",children:"View Details"})]})]},d))})]}),e.jsx(Se,{})]})};export{Re as default};
